// ============================================================================================= //
//                                           FUNCTIONS                                           //
// ============================================================================================= //

@use "sass:list";
@use "sass:map";
@use "@unsass/css/custom-properties";
@use "@unsass/string";
@use "@unsass/types" as type;
@use "../core/variables";
@use "../core/functions";

// ------------------------------------------------------------------------- //
// Private functions
// ------------------------------------------------------------------------- //

///
/// Check if color key exist.
///
@function _exist($key) {
    @return map.has-key(variables.$colors, $key);
}

// ------------------------------------------------------------------------- //
// Public functions
// ------------------------------------------------------------------------- //

///
/// Transforms a theme's tokens value into a `var()` custom properties.
///
/// @example - scss
///   $theme: (
///     "text-color": darkcyan
///   );
///
///   $theme: theme.create-theme-vars($theme, "button");
///
///   $theme: (
///     "text-color": var(--mg-button-text-color, darkcyan)
///   );
///
/// @param {Map} $theme - The theme tokens map.
/// @param {String} $prefix - Component's name to prepend for each token's custom property name.
///
/// @return {Map} The transformed theme map.
///
@function create-theme-vars($theme, $prefix) {
    @each $key, $value in $theme {
        $token: string.combine(variables.$prefix, $prefix, $key);

        @if type.is-map($theme) {
            $value: custom-properties.create-var(custom-properties.create($token, $value));
        } @else if type.is-list($theme) or type.is-string($theme) {
            $value: custom-properties.create-var(custom-properties.create($token));
        }

        $theme: map.set($theme, $key, $value);
    }

    @return $theme;
}

///
/// @deprecated Use `create-theme-vars` function instead.
///
@function create-theme-var($theme, $prefix) {
    @return create-theme-vars($theme, $prefix);
}

///
/// @example - scss
///   $color: get-theme-tokens(); -> `("primary", "secondary")`
///
/// @deprecated
///
@function get-theme-tokens() {
    @return map.keys(variables.$colors);
}

///
/// @example - scss
///   $color: get-theme-color("primary"); -> `darkcyan`
///
/// @deprecated
///
@function get-theme-color($token) {
    @if not map.has-key(variables.$colors, $token) {
        @error "Invalid color scheme, '#{$token}' doesn't exist. Choose one of '#{map.keys(variables.$colors)}'.";
    }

    @return map.get(variables.$colors, $token);
}

///
/// Validates theme's token and throws an error if tokens are invalid.
///
/// @param {Map} $reference - A map of reference tokens.
/// @param {Map} $tokens - A map of theme's tokens.
///
/// @return {Map} The validated theme map.
///
@function validate-tokens($reference, $tokens) {
    $keys: map.keys($reference);
    $unsupported-tokens: ();

    @each $key, $value in $tokens {
        @if list.index($keys, $key) == null {
            $unsupported-tokens: list.append($unsupported-tokens, $key, $separator: comma);
        }
    }

    @if list.length($unsupported-tokens) > 0 {
        @error "The following tokens are invalid: '#{$unsupported-tokens}'. The supported theme tokens are: '#{$keys}'";
    }

    @return $tokens;
}
