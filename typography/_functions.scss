// ============================================================================================= //
//                                           FUNCTIONS                                           //
// ============================================================================================= //

@use "sass:list";
@use "sass:map";
@use "@unsass/css/custom-properties";
@use "@unsass/types" as type;
@use "../core";
@use "./variables";

// ------------------------------------------------------------------------- //
// Private functions
// ------------------------------------------------------------------------- //

///
/// Check if typography token exist.
///
@function _exist($token) {
    @if not map.has-key(core.$typographies, $token) {
        @error "Invalid typography token, '#{$token}' doesn't exist. Choose one of '#{map.keys(core.$typographies)}'.";
    }

    @return map.has-key(core.$typographies, $token);
}

///
/// Check if typography property token is allowed.
///
@function _allowed-property($property) {
    @if list.index(variables.$allowed-tokens, $property) == null {
        @error "Invalid typography property token, '#{$property}' is not allowed. Choose one of '#{variables.$allowed-tokens}'.";
    }

    @return $property;
}

// ------------------------------------------------------------------------- //
// Public functions
// ------------------------------------------------------------------------- //

///
/// @example - scss
///   $typography: typography.tokens(); -> `("body-font-size", "body-font-weight")`
///
@function tokens() {
    @return map.keys(core.$typographies);
}

///
/// @example - scss
///   $typography: typography.value("body-font-size"); -> `16px`
///
@function value($token) {
    @if _exist($token) {
        @return map.get(core.$typographies, $token);
    }
}

///
/// @example - scss
///   $theme: create-typography-var("body", "button-label"); -> `("button-label-font-size": var(--mg-button-label-font-size, var(--mg-typography-body-font-size, 16px))`
///
///   .foo {
///     font-size: map.get($theme, button-label-font-size);
///   }
///
/// @example - css
///   .foo {
///     font-size: var(--mg-button-label-font-size, var(--mg-typography-body-font-size, 16px));
///   }
///
/// @param {Map} $style - The style token.
/// @param {String} $prefix - Component name to prepend for each token's custom property name.
///
@function create-typography-vars($style, $prefix) {
    $theme: ();
    $name: $style;

    @if type.is-string($style) and _exist($style) {
        $style: map.get(core.$typographies, $style);
    } @else {
        @error "Invalid typography style, `#{$style}` doesn't exist."
    }

    @each $key, $value in $style {
        @if list.index(variables.$allowed-tokens, $key) == null {
            @error "Invalid typography token, `#{$key}` is not allowed."
        }

        $theme: map.set($theme, $key, custom-properties.create-var(custom-properties.create(core.create-name(#{$prefix}-#{$key}), custom-properties.create-var(custom-properties.create(core.create-name(typography-#{$name}-#{$key}), map.get($style, $key))))));
    }

    @return $theme;
}
