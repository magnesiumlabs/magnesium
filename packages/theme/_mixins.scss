// ============================================================================================= //
//                                            MIXINS                                             //
// ============================================================================================= //

@use "sass:list";
@use "sass:map";
@use "@magnesium/core/config";
@use "@magnesium/core";
@use "@unsass/breakpoint";
@use "@unsass/css";
@use "@unsass/css/custom-properties";
@use "@unsass/selector";
@use "@unsass/types";
@use "@unsass/utilities";
@use "./functions";
@use "./variables";

///
/// Core styles.
///
/// @see {mixin} property
/// @see {function} functions.get-keys
///
@mixin core-styles {
    $extend: ();

    @if list.length(variables.$bg-colors) != 0 and (types.is-list(variables.$bg-colors) or types.is-string(variables.$bg-colors)) {
        $extend: variables.$bg-colors;
    } @else if list.length(variables.$bg-colors) == 0 or not list.length(variables.$bg-colors) {
        $extend: functions.get-keys();
    }

    // ------------------------------------------------------------------------- //
    // Main classes
    // ------------------------------------------------------------------------- //

    @each $style in functions.get-keys() {
        $selector: functions.create-name(theme--#{$style});

        @include selector.create(#{$selector}) {
            @include property(color, $style);
        }

        ///
        /// States.
        ///
        @if core.get-states-option() {
            @each $state in core.$states {
                @include selector.create(#{$selector}, $state, $pseudo-class: $state) {
                    @include property(color, $style);
                }
            }
        }

        ///
        /// Responsive.
        ///
        @if core.get-responsive-option() {
            @each $key, $value in breakpoint.get-screens() {
                @include breakpoint.up($key) {
                    @include selector.create(#{$selector}, $key) {
                        @include property(color, $style);
                    }
                }
            }
        }
    }

    // ------------------------------------------------------------------------- //
    // Background classes
    // ------------------------------------------------------------------------- //

    @each $style in $extend {
        $selector: #{functions.create-name(theme--#{$style}-bg)};

        @include selector.create(#{$selector}) {
            @include property(background-color, $style);
        }

        ///
        /// States.
        ///
        @if core.get-states-option() {
            @each $state in core.$states {
                @include selector.create(#{$selector}, $state, $pseudo-class: $state) {
                    @include property(background-color, $style);
                }
            }
        }

        ///
        /// Responsive.
        ///
        @if core.get-responsive-option() {
            @each $key, $value in breakpoint.get-screens() {
                @include breakpoint.up($key) {
                    @include selector.create(#{$selector}, $key) {
                        @include property(color, $style);
                    }
                }
            }
        }
    }
}

// ------------------------------------------------------------------------- //
// Private mixins
// ------------------------------------------------------------------------- //

// ...

// ------------------------------------------------------------------------- //
// Public mixins
// ------------------------------------------------------------------------- //

///
/// @example - scss
///   .foo {
///     @include theme.property(color, darkcyan);
///   }
///
/// @example - css
///   .foo {
///     color: darkcyan;
///   }
///
/// @example - scss
///   .foo {
///     @include theme.property(color, primary);
///   }
///
/// @example - css
///   .foo {
///     color: var(--mg-theme-primary, #2674a2);
///   }
///
/// @example - scss
///   .foo {
///     @include theme.property(primary);
///   }
///
/// @example - css
///   .foo {
///     --mg-theme-primary: #2674a2;
///   }
///
/// @example - scss
///   .foo {
///     @include theme.property(primary, darkcyan);
///   }
///
/// @example - css
///   .foo {
///     --mg-theme-primary: darkcyan;
///   }
///
/// @example - scss
///   .foo {
///     @include theme.property(custom-properties.create(foo, darkcyan));
///   }
///
/// @example - css
///   .foo {
///     --mg-foo: darkcyan;
///   }
///
/// @example - scss
///   .foo {
///     @include theme.property(custom-properties.create(--foo, darkcyan));
///   }
///
/// @example - css
///   .foo {
///     --foo: darkcyan;
///   }
///
/// @see {mixin} css.declaration
/// @see {function} core.create-var
/// @see {function} functions.create-custom-map
/// @see {function} functions.get-color
/// @see {function} functions.exist
///
@mixin property($property, $value: null, $important: false) {
    @if functions.exist($property) {
        @if $value {
            $property: functions.create-custom-map($property, $value);
        } @else {
            $property: functions.create-custom-map($property, functions.get-color($property));
        }
    } @else if functions.exist($value) {
        $value: core.create-var(functions.create-name(theme-#{$value}), if(variables.$fallback, functions.get-color($value), null));
    }

    @include css.declaration($property, $value, $important);
}

///
/// Disabled touch screen.
///
@mixin disabled-touch-screen {
    @include utilities.disabled-touch-screen {
        @content;
    }
}

///
/// Disabled pointer events.
///
@mixin disabled-pointer-events {
    @include utilities.disabled-pointer-events;
}

///
/// @example - scss
///   @include theme.prefers-color-scheme {
///     :root {
///       color: #2674a2;
///     }
///   }
///
/// @example - css
///   @media (prefers-color-scheme: light) {
///     :root {
///       color: #2674a2;
///     }
///   }
///
/// @example - scss
///   @include theme.prefers-color-scheme(dark) {
///     :root {
///       color: #2674a2;
///     }
///   }
///
/// @example - css
///   @media (prefers-color-scheme: dark) {
///     :root {
///       color: #2674a2;
///     }
///   }
///
@mixin prefers-color-scheme($scheme: light) {
    @if not map.has-key(variables.$prefers-color-scheme, $scheme) {
        @error "Invalid color scheme, '#{$scheme}' doesn't exist. Choose one of #{map.keys(variables.$prefers-color-scheme)}.";
    }

    @media (prefers-color-scheme: $scheme) {
        @content;
    }
}

///
/// @example - scss
///   :root {
///     @include theme.create((
///       btn-bg-color: darkcyan
///     ));
///   }
///
/// @example - css
///   :root {
///     --mg-btn-bg-color: darkcyan;
///   }
///
@mixin create($theme) {
    @each $key, $value in $theme {
        @include css.declaration(custom-properties.create(functions.create-name($key), $value));
    }
}
